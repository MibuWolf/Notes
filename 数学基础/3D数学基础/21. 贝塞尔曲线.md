---
tags:
  - maths curves
---

# 1. Bezier曲线

## 1.1 概述

前面两章介绍了通过经过点或者通过初始点，初始速度，终点，终点速度计算曲线的方式。Bezier曲线是通过控制点影响曲线的一种曲线建构方式。Bezier曲线第一个和最后一个控制点分布是曲线的开始点和结束点，其他控制点用于控制曲线走势形状, 如下图:

![[Pic_135.png]]

## 1.2 德卡斯特里奥(de Casteljau)算法

该算法的思想是: 取每个控制点的连线，并在每条连线的t(取值范围0-1)位置生成新的控制点并用新的控制点继续连线，直到最后一条连线的t位置就是整段贝塞尔曲线的t(取值范围0-1)点坐标。下图很好的描述了这一过程：

![[Pic_136.png]]

简单来说de Casteljau算法的递归公式如下：

![[Pic_137.png]]

由此递归公式我们可以推导下贝塞尔曲线的多项式函数，此处我们以三个控制点为例展示推导过程，四个控制点的贝塞尔曲线只给出公式自己可以去推导。假设$b0, b1, b2$三个点位贝塞尔曲线的三个控制点，由递归公式推导如下：

![[Pic_138.png]]

同样的方法推导其他个数控制点的贝塞尔曲线公式：

![[Pic_139.png]]
![[Pic_140.png]]

# 2. Bezier曲线方程

**通用贝塞尔曲线函数：**观察以上1-5个控制点的贝塞尔公式很容易发现他们符合一个特定的规律:

- 多项式公式中的每一项都有$(1-t)$的幂和$t$的幂。   
- $t$的幂从$0$递增到$n$(n位控制点个数)，$(1-t)$的幂则从$n$递减到$0$。
- 从左到右每一项都把一个控制点$bi$作为乘数。
- 常数项从左到右符合帕斯卡三角。

![[Pic_141.png]]

学过离散数学的一定还记得排列组合，组合运算的结果就是一个帕斯卡三角。组合的计算如下：

![[Pic_142.png]]

由此讲上述多项式公式中的每一项公式化为：

![[Pic_143.png]]

因此对于任意n个控制点的贝塞尔曲线公式则为：

![[Pic_144.png]]

# 3. Bezier曲线的导数(切线/斜率)

Bezier曲线的斜率：此处我们以三阶(四个控制点)贝塞尔曲线为例研究贝塞尔曲线斜率。由上述论我们可知曲线公式:    $P(t)=(1-t)³b0+3t(1-t)²b1+3t(1-t)b2+t³b3$ 对该曲线求导得出：$V(t)=3(b1-b0)+2(3b0-6b1+3b2)t+3(-b0+3b1-3b2+b3)t²$   此时分别将$t=0$，$t=1$代入公式可以算出起始点和终点的斜率分别为: $V(0) = 3(b1-b0)$       $V(1) = 3(b3-b2)$        由此得出Bezier曲线的一个特性：     ***Bezier曲线前两个控制点的连线是曲线开始点的切线，最后两个点的连线时曲线终点的切线。***
当我们继续对V$(t)$求导时用同样的方法我们可以得出结论，开始点，结束点的第$N$次求导由他相邻的$N+1$个控制点决定。同时我们通过观察发现在德卡斯特里奥递归算法中的最后一级的两个控制点的方向就是该曲线点的切线方向。

![[Pic_145.gif]]

如该动图中粉红色线一致与曲线相切，粉红色线就是de Casteljau算法递归到最后两个控制点。

# 4. 总结

- 可以德卡斯特里奥算法计算贝塞尔曲线任意位置t的坐标，具体做法是将所有控制点连线，找出每条连线t位置为新的控制点继续连线知道最后一条线的t位置即为曲线t的坐标。t表示的是从线开始点到结束点的比例$(0<=t<=1)$
- 通用贝塞尔公式为：$P(t) = C(n,0)*t$的0次方$*(1-t)$的n次方$*P0 + C(n,1)*t$的1次方*(1-t)的n-1次方$*P1 +..... + C(n,n)*t$的n次方$*(1-t)$的0次方$*Pn$。$C(n,k)$ 是排列组合算法 $= n! / k!(n-k)!$   Pi表示第i个控制点坐标。
- 贝塞尔曲线开始点，结束点的N阶导数只跟与之相邻的N+1个控制点有关，且开始点，结束点的斜率就是相邻两控制点的连线。
- 德卡斯特里奥递归算法中的最后一级的两个控制点的方向就是该曲线点的切线方向

