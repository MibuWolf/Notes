---
tags:
  - ue unreal metahuman riglogic DNA
---

# 1. 概述

DNA文件是MetaHuman中非常重要的一个资源配置文件，整个NDA文件中不仅保存了当前角色的基本信息，还保存了控制器与骨骼的绑定关系，基础表情单元(AU)及表情矫正的动作,MorphTarget信息，甚至还有蒙皮，混合形变及纹理动画等相关信息。

DNA相当于美术离线制作的一个效果文件(可以类比想象成一个带模型的动作文件)，而RigLogic的作用则是从DNA数据中采样数据并驱动骨骼，BlendShape(MorphTarget)，材质效果等发生作用。具体来说，运行时通过播放表情动画文件或者Sequencer修复几百根与表情相关的曲线值，RigLogic负责将几百个曲线值整理成一维Float数组作为输入，去DNA数据中查询当前表情的骨骼，BlendShape，动画贴图等数据，并通过调用相应功能接口最终实现表情动画效果。

**注：关于带有几百条曲线的表情动画的制作导出方式，请参见：[MetaHuman文档 | Epic Developer Community (epicgames.com)](https://dev.epicgames.com/documentation/zh-cn/metahuman/metahuman-documentation)**

# 2. DNA数据结构

## 2.1 DNA文件基本结构

在[[RigLogicWhitePaper.pdf]]及官方提供的DNA矫正工具[EpicGames/MetaHuman-DNA-校准 (github.com)](https://github.com/EpicGames/MetaHuman-DNA-Calibration/)文档中都有提及：整个DNA是以二进制格式存储的(利用DNA校准工具可以将其转换成Json方便阅读和理解)。

在结构上DNA中的数据会被分成多个逻辑层，如下图所示：

![[UnrealEngine/MetaHuman/attachments/Pic_069.png]]

## 2.2 DNA校准与Json格式文件

[EpicGames/MetaHuman-DNA-校准 (github.com)](https://github.com/EpicGames/MetaHuman-DNA-Calibration/)是官方提供的修改DNA数据的工具库，它包含了对DNA文件中各种数据的读写操作，并为Maya提供了一些常见的操作DNA的脚本插件。

上文提到，DNA存储的是二进制格式的文件，这并不利于我们深入学习和理解DNA中存储的数据格式。好在官方在[EpicGames/MetaHuman-DNA-校准 (github.com)](https://github.com/EpicGames/MetaHuman-DNA-Calibration/) 中为我们提供了将DNA文件转化成可阅读性更好的Json格式的脚本(DNA校准工具的用法GitHub上有较为详细的使用文档，也有很多视频教程在此不做赘述)。接下来我们将结合转化成Json格式![[Omar.json]]的DNA文件![[Omar.dna]]深入了解其存储数据的格式及运行时的映射方案。


# 3. DNA数据分析及映射

