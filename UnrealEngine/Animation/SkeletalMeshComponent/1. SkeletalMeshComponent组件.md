---
tags:
  - ue unreal animation skeletalmesh
---

# 1. 概述

SkeletalMeshComponent是UnrealEngine中最复杂的组件之一。从功能上来说，该组件不仅要负责[[2. 动画蓝图的更新与评价(UAnimInstance)|动画及蓝图更新]]，[[4. 动画与移动|为移动提供RootMotion信息]]，也要提供对[[5. 物理动画概述|物理动画效果]]，[[8. 布料模拟|布料模拟]]的支持，最终还有将骨骼信息提交渲染线程完成最终的[[10. SkeletalMesh的渲染|SkeletalMesh的渲染]]。
从具体实现角度来说，SkeletalMeshComponent既要在主线程为移动同步提供RootMotion信息，还要与物理线程对接设置物理体及布料模拟数据，最终与渲染线程配合提交骨骼数据完成渲染。
本系列文章将从以上各个方面讨论分析SkeletalMeshComponent的具体实现细节，并在左后绘制其工作的流程图。

# 2. 结构说明

简单来说，SkeletalMeshComponent主要实现四个方面的功能：动画及蓝图的更新，动画驱动的移动处理，拟真动画模拟(布料及物理动画)以及骨骼动画的绘制与渲染。虽然SkeletalMeshComponent涉及这四个方面的功能，但并不意味着所有逻辑均在SkeletalMeshComponent类中实现。这也很容易理解，假设所有功能全部在一个类中实现，那么这个类将会变得无比巨大且难以维护。
在此我们只是初步了解下SkeletalMeshComponent的基本结构，以及他与哪些组件/类配合来实现这些具体功能的，更多细节在后续笔记中详细讨论。

# 2.1 动作及蓝图更新

动作更新是SkeletalMeshComponent中最基础的一个功能，在UnrelEngine中对于动作个管理一般是通过动画蓝图中的动作状态机和一个特殊的Montage动画来实现的，对于此部分功能的实现封装在UAnimInstance类中。
[[2. 动画蓝图的更新与评价(UAnimInstance)|UAnimInstance]]类负责[[2. 动画蓝图的更新与评价(UAnimInstance)#2. 动画蓝图的更新与评价|更新和评价蓝图]]，所谓的更新指的是更新动画状态机以及动作播放的时间位置混合数据等参数，而评价则是根据当前播放的动作(及blend信息)计算更新骨骼Transfrom信息。当然具体的更新/评价逻辑分散在各个FAnimNode中。[[3. 常用动作节点( FAnimNode)|动作节点(FAnimNode)]]则是对各种动作中使用到的技术/特性的封装(常见的如：状态机节点(StateMachine)  OrientationWraping节点等)。
对动画蓝图的更新和评价是一个复杂的过程涉及到大量的计算(递归调用动作节点以及对每根骨骼的计算与转换)，因此很自然的对这部分的更新计算是支持多线程的，实际上多数时候我们确实使用多线程的方式运行动画蓝图，更多详细细节参见：[[2. 动画蓝图的更新与评价(UAnimInstance)|动画蓝图的更新与评价]]

# 2.2 动画与移动

