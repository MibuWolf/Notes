
---
tags:
  - maths graphics
---

# 贴花

贴花是常用的效果，其原理很简单就是使用贴图映射到物体表面。在VertexShader中将顶点转换的裁剪空间，在PixelShader中逐像素对贴图采样。代码如下:

![[Pic_077.png]]
![[Pic_078.png]]

# Blinn-Phong光照

## 概述

Blinn-Phong式光照的基本原理之前已做过解释，在此通过示例代码对比PongShader(逐像素光照)，GouraudShader(逐顶点光照)以及带有BumpTexture的光照计算实现。

## 逐像素的PhongShading

在此方案中的光照计算是对每个像素进行光照计算的，因此需要将法线，顶点位置等信息(在此用的是模型空间，当然也可以使用其他空间)传递到PixelShader中计算光照。具体代码如下：

![[Pic_079.png]]
![[Pic_080.png]]
![[3D数学基础/attachments/Pic_081.png]]
![[Pic_082.png]]

**注: 该光照计算方式又有几个变种，一种变种是在世界空间/相机空间计算向量(可以根据方便自行选择，但所有向量必须在同一空间)，另一变种是向量相关计算在VertexShader中进行PixelShader中只进行光照计算，这样做的目的是减少向量计算次数提升效率。**

## 带法线贴图的光照计算

因为要使用法线贴图法线必须在PixelShader中采样，因此只能采用PongShading的光照方式，接下来我们要在顶点着色器将光照向量和半向量转到切线空间计算。(还记得为什么要在VertexShader转到切线空间吗？记得如何构造切线空间吗？翻翻笔记吧)具体代码如下：

![[Pic_083.png]]
![[Pic_084.png]]
![[Pic_085.png]]

## 骨骼动画带法线贴图的光照计算

为了降低CPU的使用率，我们可以将骨骼动画的计算放到VertexShader中计算，原理很简单就是根据受影响的骨骼矩阵计算出蒙皮顶点信息。之后再将顶点送入带法线贴图的光照流程中计算即可。由于PixelShader部分与带发现贴图光照计算完全一致，在此仅展示VertxShader部分代码如下：

![[Pic_086.png]]
![[Pic_087.png]]


