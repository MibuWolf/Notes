---
tags:
  - graphics light illumination
---

# 1. 光照

本章讨论的是光照测量的实际问题，初看起来者与图形学似乎并没有直接的关系，但实际上图形学中的光照计算是对现实光照的模拟和简化，学习光照在现实中的测量是图形学中的光照模拟的基础。

# 2. 辐射测量

## 2.1 基本概念

光具有波粒二象性，因此具有波的特性也具有粒子的特性。可以将有一定位置和传播方向的光的粒子称为光子。如果光子的传播速度是$c$，光子的波长是$λ$，则光子的频率 $f = c/ λ$。光子的速度仅取决于它的传输介质的折射系数n。并且当光从一个介质传入到另一介质时，光子的能量q不会发生变化且频率 f 也不会发生变化：$q = hf = hc / λ$ 其中$h=6.63*10^-34J$(焦耳),为普朗克常量。

## 2.2 光谱能量/功率/辐射度(量)/辐射率

一个光子的能量是$q$，由上述公式 $q = hf = hc / λ$  可见能量只与光子的波长/频率有关，因此一束光照射进来在某一频段/波长范围的光的能量值就被称为光谱能量公式为$Q = Δq / Δλ$($Δλ$表示的是范围,$Δq$表示的是该范围内的所有光子能量，也就是说光谱能量Q表示的是波长λ范围从$[λ-Δλ/2, λ +Δλ/2]$内的的光子能量的平均 )。功率是单位时间内光照的能量值。其公式可以写为: $ΔQ = Δq / (ΔλΔt)$。以上描述变量只能描述光照强度，在图形学中我们关心的是物体表面受光照的情况，因此就需要引入跟面积相关的概念辐射度/量,其含义是单位面积上收到的光照功率。公式为：$H=Δq / (ΔλΔtΔA)$(其中ΔA是面积)。在图形学中要计算表面光照仅有辐射度(量)仍然是不够的，因为只有以一定角度射向物体表面的光照才能被"看"到，因此引入概念辐射率指在特定角度Δσ(可以想象为球面坐标系下的单位角度)范围内的辐射度(量)因此辐射率$L=ΔH/(Δσcosθ)=Δq/(ΔλΔtΔAΔσcosθ)$ 既然$Δσ$表示特定角度的辐射度(量)了为什么还要乘以$cosθ$呢？如下图：$Δσ$表示的紫色区域角度(极坐标系)

![[计算机图形学/attachments/Pic_093.png]]

由于辐射率L是某特定方向范围内的辐射度(量)，那么所有方向的辐射率之和就是辐射度即: $H=∫Lcosθdσ$

![[计算机图形学/attachments/Pic_094.png]]

由上图如果入射方向向量$k$为单位向量，$dσ$可以看做球面坐标系(参考3D数学基础中的极坐标)中的一部分，则： $dσ = rsinθdθdφ = sinθdθdφ$ ($r$为单位向量)此时:  $H = ∫∫ Lf cosθ sinθ dθdφ = πLf$

![[计算机图形学/attachments/Pic_095.png]]

**注：$Lf$表示的是物体表面的入射光辐射率，常用的还有$Ls$表示物体表面反射光的辐射率。**

# 3. BRDF

## 3.1 概念

$BRDF$的全称是双向反射分布函数，在图形学计算光照时常用的一个函数。由于我们关心的是可见表面的外观，因此我们经常需要计算表面的反射光。$BRDF$用来定义给定入射方向上的辐射量(度)如何影响给定出射方向上的辐射率。函数可以记做：$BRDF(ki, ko) = Lko / H$   其中$ki$表示表面到光源的向量(入射光向量的反向量), $ko$表示表面的反射向量。$Lko$表示的是反射光在$ko$方向的辐射率，$H$表示$ki$入射光在表面的辐射度。

## 3.2 定向半球反射

了解了$BRDF$的基本含义我们可能就会想，针对入射方向ki的光有多少被反射出去了呢？这个比例就是入射角ki的半球面反射系数，即：$R(ki) =$ 所有反射方向$ko$上的辐射量/入射光$ki$方向上的辐射量。  简单来说入射方向ki上的半球面方向反射系数：$R(ki) = Eall / H$ （$Eall$表示所有出射方向的辐射量，$H$表示$ki$入射光的辐射量）直接考虑所有反射方向辐射量$Eall$比较复杂，我们先看任意反射方向的辐射量$Eko$。我们由辐射率的定义可以知道$ko$方向的光线辐射率为：       $Lko = Eko / cosθdσ$    再由双向反射分布函数可知：$BRDF(ki,ko)= Lko / H => Lko = H*BRDF(ki,ko)$结合两个方程式：$Eko= H*BRDF(ki,ko)*cosθd$σ   由此可知：R$(ki) = Eall / H = ∫Eko / H$  将刚刚计算的任意反射方向的辐射量Eko代入此公式可得，任意入射角ki的半球方向反射系数为： $R(ki) = ∫ BRDF(ki,ko)*cosθdσ$

## 3.3 理想漫反射的BRDF

理想漫反射表面被称为朗伯表面(Lambertian)，其特点是向任意方向的反射量都相等且为常量。则$BRDF(ki,ko) = C$;  ($C$为常量)此时的半球面反射系数$ R(ki) = ∫ C*cosθdσ$ 将其转化到半球面坐标后可得出：

![[计算机图形学/attachments/Pic_096.png]]

如果理想状态下全反射则：$R(ki) = πC = 1$ 此时        $BRDF(ki,ko) = C = r / π$

# 4. 渲染方程

在3D数学基础的<<基本渲染流程>>中我们提到渲染方程，渲染方程计算的是某反射角度所反射出来的光照辐射率的总量。我们已经知道双向反射分布函数BRDF计算的是以$ki$为入射方向的辐射量与以$ko$为反射方向的辐射率的比值。$BRDF(ki,ko) = Lo / Hi$ ($Lo$为$ko$方向的反射光辐射率，$Hi$为入射方向为$ki$的光照辐射量。)由辐射量与辐射率的关系可知 $Hi = LicosθiΔσ$  由此可知： $Lo = BRDF(ki,ko) * LicosθiΔσ$  这是根据一个入射角度ki推导出的该方向的入射光在$k0$方向反射光的辐射率。而渲染方程是所有入射光在$k0$方向反射光辐射率的总和，因此渲染方程如下：

![[计算机图形学/attachments/Pic_097.png]]

# 5. 光度测定

人眼对不同频率/波长的光线的识别度是不同的，人眼可识别的可见光波长范围是从$380nm~800nm$。因此就图形学而言更为有效的是要测定人眼可识别的光的辐射率。计算机图形学中常用的光度测定量是亮度，其辐射率的模拟结果为：$Y = 683lm/W * ∫ y(λ)*L(λ)dλ$ ($λ$从$380$到$800nm$积分) 其中$Y$表示亮度，$y(λ$)为人的视觉系统对发光的识别效率函数。$L(λ)$表示$λ$波长的辐射率。 $683lm/W$为每瓦产生$683$流明。

![[计算机图形学/attachments/Pic_098.png]]

# 6. 总结

- 本章是高级光照计算的理论基础，介绍了光照强度的基本单位，光的辐射量，辐射率。介绍了计算以$ki$为入射向量$ko$为反射向量的$BRDF$函数(以$ko$为反射方向的光辐射率与以ki为入射角度的光辐射量之比)。介绍了渲染函数即所有入射方向光照在$ko$方向反射的光辐射率总和的计算方程。还提及了以人眼识别为目的的光强度测定公式：$Y=683* y(λ)*L(λ)dλ.$
- 光在一种介质中的传输速度$c = f * λ$ $f$是光的频率 $λ$是波长。光也是一种能量，不同波长/频率的能量大小也不同但都遵循 $q = h*f = h*c/λ$（$q$是能量 $h$是常数）。根据物理学我们知道功率是单位时间内做的功。因此光的功率 = $q / t$;    就图形学而言，我们关心的不是功率，而是作用在物体表面的光照强度，因此就有了光辐射度/量这个概念，它表示单位面积上的光的功率即 $H = Q / (t*S)$ // S是面积。但这仍不能很好的描述图形学中的光照强度，因为我们关心的往往是特定方向/角度上的光照强度，因此就引入新的概念光的辐射率，指的是就某一方向单位锥体(球面坐标系)内的光辐射度。    $L = H / cosθdσ$
- $BRDF$是计算以k$o$为反射方向的光辐射率与以ki为入射方向的光辐射度的比值的函数。
- 定向半球反射系数是指以$ko$为反射方向的光辐射率的总和与以$ki$为入射方向的光的辐射量之比。$R(ki) = ∫ BRDF(ki,ko)*cosθdσ$
- 渲染方程是指计算所有方向入射光在特定反射方向$ko$反射光的辐射率。 $Lo = ∫BRDF(ki,ko) * LicosθiΔσ$