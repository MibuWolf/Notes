---
tags:
  - graphics
---

# 1. 渲染管线概述

在3D数学基础的实时图形渲染管线中我们了解了渲染管线的流程：可见性对象确定，设置渲染参数，顶点处理，几何形变，栅格化，像素处理，Blend混合输出。在此我们详细讲解几个重要步骤。

# 2. 栅格化

## 2.1 概述

前面一些步骤不是我们本章的重点，我们只需要知道前面的步骤确定了哪些对象会被渲染，设置好了渲染状态及参数并将顶点及顶点上的属性(eg:color,normal...)转化到了裁剪空间。栅格化就是将图元顶点属性差值到图元中的每个像素。

## 2.2 画线

由开始点$(x0,y0)$和结束点$(x1,y)$画线很简单，首先找出该直线方程：$f(x,y)=(y0-y1)x+(x1-x0)y+x0y1-x1y0 = 0;$ 由于像素是格子所以画线时会遇到不连续的情况(如下图)，处理方式就是检测每个像素中点与直线的位置，如果在直线以上在去上方像素作为画线像素。

![[计算机图形学/attachments/Pic_001.png]]

## 2.3 画三角形

画三角形的原理就是遵循Gouraud插值法，对三角形内任意像素计算出相对于三个顶点的权重$(α，β，γ)$分别与三个顶点的属性相乘：$atr = α*atr1 + β*atr2 +γ*atr3$。    $α, β，γ$权重值的确定方式就是用每个像素到三角形边的距离，如果$a,b,c$是三个顶点则：$α = F(pixel) / Fbc(a)$。 $Fbc(p)$表示$bc$边的方程，$Fbc(a)$表示顶点$a$到$bc$边的距离，$F(pixel)$表示当前像素点到$bc$边的距离。

# 3. 栅格化前后的详细操作

        详细的过程：在应用程序层通过八叉树等手段确定可见物体对象，之后将每个可见对象送入渲染管线：
- 为每个渲染对象设置各自的渲染状态(提交顶点等信息)此过程在应用程序中完成。
- 在顶点着色器对顶点属性进行计算(如：光照法线等)并将顶点通过矩阵变化转化到裁剪空间。此过程在VertexShader中完成。
- 在裁剪空间进行裁剪，背面剔除后确定可以进入屏幕空间的顶点及其属性。此过程由硬件处理。
- 将顶点属性(颜色和其他自定义属性)栅格化到每个像素。此过程由硬件处理。
- 逐像素进行像素颜色计算(可以纹理采样，光照计算，特殊效果处理)后输出颜色纸。此过程在FragmentShader中完成。
- 根据深度和混合设定对输出值和当前缓冲区值进行融合以及深度更新。此过程由硬件处理。

# 4. 简单抗锯齿

        SSAA(SuperSamplingAntialiasing): 由画线的方式我们可以看出在边缘(线)位置经常出现锯齿，因此我们需要使用一些方式来减少或者消除锯齿，这个过程就被称为抗锯齿(AA)。抗拒出的方式很多，这里介绍下最简单的超级采样抗锯齿(SSAA)。所谓超级采样，简单说就是创建高分辨率图像，然后进行采样将多个像素融合成一个像素的方式。eg：我们要绘制到屏幕上的图片大小是256*256，我们把后台缓存区创建成1024*1024大小，然后每四个像素如何成256*256图像中的一个像素。但这种抗锯齿的开销也是非常大的，后续会介绍其他方式的抗锯齿。

# 5. 总结

- 本章基本是对3D数学基础中的渲染管线的一次回顾，同时也是学习图形学基础的开始
- 本章简单介绍了对线，三角形区域中的像素的栅格化算法，并同时引入的抗锯齿的概念。
- SSAA是众多抗锯齿算法中最简单的一种，其原理就是绘制一张更高清的图并用高清图中多个像素融合成低像素图中的一个像素。该方法固然简单但是性能开销也是巨大的。