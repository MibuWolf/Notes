
---
tags:
  - graphics light illumination global-illumination reflection
---

# 现实世界的材质

## 概述

之前我们介绍的双向反射分布函数BRDF，渲染方程等都是高度抽象的公式。在现实世界中光线照射到不同材质上会有不同的表现效果，因此在图形学中对不同类型的材质进行光照计算时，所有选用的具体BRDF方程可能会有所不同。

## 光滑电介质与金属

电介质是一种能够折射光的材料，其基本性质(反射率/折射率)请参见<[[8. 光线追踪2|光线追踪2]]。金属与电介质类似只是其折射部分会被快速吸收。因此当光线射到金属和光滑电介质表面时一部分光线发生了镜面发射另一部分发生折射(被吸收)，可以认为没有漫反射的发生。镜面反射率R部分根据菲涅尔公式决定，1-R则是折射或者被吸收的部分。

## 粗糙电介质与金属表面

如果将金属/电介质的表面变得粗糙(微表面)。这样的表面在近距离上具有镜面的行为，但在较远距离上看就会以分布状态将光传播开。其本质上仍然是镜面反射和折射。只是镜面反射的效果受表面粗糙度影响。(回想下Phong式光照中镜面反射部分的计算$(n▪h)ⁿ$ 其中$n$就是表面的光滑度)

## 漫射材质

对于不发光也不光滑的非电介质材质一般都是漫射材质。例如：木头，石头等。为了简单模拟可以使用朗伯(理想漫反射)BRDF反射函数($R/π,R$是反射率)来模拟漫反射表面。在具体实现中有时也用$n▪l$来模拟计算漫反射。

## 半透明材质

很多薄的物体，例如树叶，薄纱，纸张等，既会发生漫反射又会发生透射，透射的光线过来就形成了或清晰或抹灰的半透明效果。

## 分层材质

分层材质也可以理解为复合材质，可以理解为光射到物体表面时，一部分光直接法神了镜面反射，另一部分折射入材质内部再经过散射后回到物体表面形成漫反射光，如下图：

![[计算机图形学/attachments/Pic_110.png]]

***注意，在此种材质中漫反射部分并非固定不变的(与漫反射材质不同)，由菲涅尔定理可知表面的反射率会随入射角度变化而改变,因此由能量守恒可知折射入内部的光辐射率也会随入射角改变，自然漫反射部分也会与入射角角度有关。***

# 反射模型理论

## 概述

Phong式光照模型是基于理论模拟的，而光线追踪的光照计算则是基于真实物理世界的。但是很不幸光线追踪的光照计算方式计算过于复杂性能较差。实际上现在较为流行的是基于物理的模拟逼近显示的光照模型(PBR)。该光照模型有以下特征：由于此光照模型是基于物理的，因此遵守能量守恒定律并且BRDF方程式可逆的。此外将光照表面视为微表面(既不是绝对光滑也不是理想漫反射)，目的是可以清晰的分类漫反射分量和镜面反射分量。

## 理论基础

所有材质类型表面的光照计算都遵循以下理论规则。
- **能量守恒**：对于任意入射光方向ki，在物体表面所有方向反射光的反射率之和小于等于1.既：
  ![[计算机图形学/attachments/Pic_111.png]]
  真实世界中能量守恒，入射光能量一部分反射一部分折射或者被吸收。因此所有的方向的反射辐射率之和最大等于入射光辐射率(没有折射，也没有吸收)
- **基于物理的BRDF**：物理世界中光具有可逆性，也就是说从$ki$入射到$ko$反射与$ko$入射到ki反射都是可逆的。即：
  ![[计算机图形学/attachments/Pic_112.png]]
- **微表面理论**：任何表面即不可能是绝对的光滑也不会是理想的漫反射，因此需要清晰的分离漫反射和镜面反射分量。

# 漫反射与镜面反射模型

漫反射和镜面反射是两个最基础的反射模型，理想漫反射在之前已经介绍过并有结论理想漫反射下的$BRDF$函数为: $R / π$。 $R$为反射率，如果所有入射光全部漫反射则$BRDF$为 $1 / π$。对于金属电介质的反射率，之前也有介绍近似认为反射率：$R = R0 + (1-R0)(1-cosθ)^5$ 。$R0$为初始反射率。

# 光滑分层模型

## 概述

类似于分层材质，光线照射到表面在表面产生镜面反射，经过散射和折射后又在表面形成漫反射的光照模型就是光滑分层模型，如下图：

![[计算机图形学/attachments/Pic_113.png]]

由上图可以清楚看到，随之光线和视角不同，镜面反射率和漫反射率各不相同。

## 简单但错误的BRDF方程

对这种光滑分层模型需要构建其$BRDF$方程，明显可以分为镜面反射部分$BRDF$贡献和漫反射$BRDF$贡献因此：分层光滑模型的$BRDF$方程如下：                                     $ρ(ki,ko) = Rf(ki)*ρf(ki,ko) + Rd(ki)*ρd(ki,ko)$      $ρ(ki,ko)$为以$ki$为入射向量$ko$为反射向量的光滑分层光照模型的$BRDF$方程，$Rf(ki), Rd(ki)$分别为镜面反射和漫反射的反射率。$ρf(ki,ko) ρd(ki,ko)$分别为镜面反射和漫反射的$BRDF$方程。考虑能量守恒，当不考虑光线吸收时，可以认定$Rf(ki)+Rd(ki) = 1$.考虑到理想漫反射的B$RDF$方程为： $R/ π$  那么很自然就会将平滑分层的$BRDF$方程写为：           $ρ(ki,ko) = Rf(ki)*ρf(ki,ko) + (1 - Rf(ki)) / π$   但这个公式是错误的，因为它不满足$BRDF$方程的双向性。当交换入射出射方向时，理论上应该是：$ρ(ko,ki) = ρ(ki,ko)$但是在此公式中前半部分$Rf(ki)*ρf(ki,ko)$没有问题，但后半部分的漫反射部分：$(1 - Rf(ki)) / π$  当将ki换成k$o$时，由于镜面光照的反射率$Rf(ko)$已经发生变化，因此该值也会发生变化从而导致不具有可逆性从而导致某些角度下漫反射异常。

## 耦合模型

此方式推导过程没太懂(参见虎书第四版24.4虎书(计算机图形学基础)第三版24.4)这里只写结论，光滑分层光照模型的$BRDF$方程为： $ρ(ko,ki) = [R0+(1-coski)^5(1-R0)]*ρf(ko,ki)+kRm(λ)*[1-(1-coski)^5]*[1-(1-cosko)^5]$        其中$[R0+(1-coski)^5(1-R0)]$是由菲涅尔方程计算出的镜面反射的反射率。$kRm(λ)$为漫反射颜色值$coski， cosko$分别为入射角角度和出射角角度的$cos$值。

# 粗糙分层模型

## 概述

对于表面光滑物体表面可以使用光滑分层模型，但如果表面并非理想情况，表面也会有写漫反射分量时则问题更为复杂。此处我没看太明白以下只几率镜面反射分量BRDF和漫反射分量BRDF结论。首先粗糙分层模型也是将BRDF分为漫反射部分和镜面反射部分,如下：                    $ρ(ki,ko) = Rf(ki)*ρf(ki,ko) + Rd(ki)*ρd(ki,ko)$

## 漫反射部分BRDF

![[计算机图形学/attachments/Pic_114.png]]

# 总结

- 基于现实世界中对不同材质的表面反射建立不同的BRDF反射方程
- 光照射在金属/电介质可以认为只有两个分量一个是镜面反射，一个是折射(被吸收),反射率由菲涅尔方程$R0 + (1-R0)(1-nv)^5$决定。
- 漫反射材质则基本只有漫反射光没有镜面反射光
- 分层材质则是既有漫反射又有镜面反射，多数材质如此。
- 对多层材质$BRDF$的建立的重点是区分漫反射$BRDF$和镜面反射$BRDF$以及其各自的反射率。