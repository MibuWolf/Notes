
---
tags:
  - graphics
---

# 卷积滤波器

## 滤波器函数

在介绍常见滤波函数前我们先定义滤波函数为$f(x)$,要被滤波的原采样函数为 $s(x)$。滤波后的函数为$a(x)$。也就是说:$a(x)= s ★ f$，可以理解为原采样数据$s$经过滤波器f处理后变为新采样数据$a$。在图形学中常见的滤波器函数一般都有两个特点：1.  滤波函数有一定的滤波范围r(在范围之外的滤波函数值恒为0)。2. 在滤波范围内的滤波函数面积为1(也就是说$f(x)dx$在范围$r$内积分为1)。这两点是什么含义呢？先让我们来回顾下卷积公式如下： $a(x)= s ★ f = ∑ s(i)f(x-i)$                 由这个公式可以很容易观察到当计算新采样函数   在任一点$x1$的值时，由于滤波器函数$f$的范围$r$(范围外滤波器函数值恒为0)就使得卷积公式中$i$大于$x1+r/2$或者$i$小于等于$x1-r/2$的时候此时滤波器函数参数$x1-i$在$[-r/2, r/2]$范围之外，也就是说此时$f(x1)$的值为0。因此滤波函数范围限定了影响最终x1点值的原始函数范围$(x1-r/2, x1+r/2)$。在滤波范围内的滤波函数面积为1(也就是说$f(x)dx$在范围$r$内积分为1)就是为了保证在$r$范围内部改变原始信号强度(平均值)。

## 常见的滤波器函数

### 盒式滤波器

![[计算机图形学/attachments/Pic_007.png]]

***其含义是将原数据$x1$附近$r$范围内的数据求平均值后得出新的$x1$处的数据。***

### 帐篷滤波器

![[计算机图形学/attachments/Pic_008.png]]

***其含义是将原数据$x1$附近r范围内的数据加权(权值与距离$x1$距离成反比)平均值后得出新的$x1$处的数据。***

### 高斯滤波器

![[计算机图形学/attachments/Pic_009.png]]

***其含义是将原数据$1x$附近r范围内的数据加权(权值比帐篷滤波器更平滑)平均值后得出新的$x1$处的数据。***

### B样条立方滤波器

![[计算机图形学/attachments/Pic_010.png]]

### C样条立方滤波器

![[计算机图形学/attachments/Pic_011.png]]

### M样条立方滤波器

![[计算机图形学/attachments/Pic_012.png]]

# 图像信号处理

## 图像滤波概述

之前的滤波器都是基于一维的，在图形学中更多的是对像素进行二位的滤波处理，但其滤波器原理及计算方式并无变化。例如我们尅一样利用盒式滤波器或者高斯滤波器实现模糊效果盒锐化效果等。

## 常见图形滤波器

在图形学中最常有用的滤波器应该就是利用盒式滤波器或者高斯滤波器将一个像素周围像素加权平均成当前像素从而实现图像模糊的效果。

![[计算机图形学/attachments/Pic_013.png]]

同样的滤波器相反的操作就是讲图像锐化处理：

![[计算机图形学/attachments/Pic_014.png]]
![[计算机图形学/attachments/Pic_015.png]]

另一个常用的效果是阴影效果，其通常是对对象的外边轮廓线平移在做模糊化处理，用于平移的滤波器大致如下：

![[计算机图形学/attachments/Pic_016.png]]

先对其进行平移然后进行高斯模糊处理：

![[计算机图形学/attachments/Pic_017.png]]

# 图像的重构和重采样

图形学中经常遇到的一种图像操作就是重采样(更才采样评率或者改变图像大小)。由于原始图像在函数公式中是不连续的(是对每个像素点的采样)，要改变采样频率重新采样就需要把不连续像素点还原成连续的采样函数再进行重采样(这个过程就是重构)。但如果仅是把像素点重构为连续的函数在进行采样会发生摩尔纹现象，因此需要对重构后的函数进行平滑处理再进行重采样。如下图：

![[计算机图形学/attachments/Pic_018.png]]

由于将采样函数连续化以及平滑处理都可以用之前滤波器处理(eg：盒式滤波器将不连续的像素通过平均值的方式变为连续同时也是一种平滑处理)，因此可以结合性能和品质选择不同的滤波器。盒式滤波器函数f性能最好效果最差，帐篷过滤器函数f性能及效果居中，B/C/M两条立方滤波器函数f性能最差效果最好。整个重采样过程伪代码如下：

![[计算机图形学/attachments/Pic_019.png]]

# 采样与傅里叶变换

## 傅里叶变化概述

傅里叶变化的基本内容请参见[[25. 傅里叶变换]]。傅里叶变换的含义是将一个随时间变换的振幅函数变化到随频率变化的振幅函数。傅里叶逆变换就是从一个以频率为变化单位的函数变化到一个以时间为变化单位的函数。傅里叶变化: $F(ξ) =∫f(t)*e^(-2πξti )dt$ $ξ$是频率$F(ξ)$是以频率为变量的函数，$f(t)$是以$t$为变量的振幅函数，此函数$F(ξ)$称为原函数$f(t)$的傅里叶变化。同样变量含义 $f(t) = ∫F(ξ)*e^(2πξti )dξ$  此函数$f(t)$称为原函数$fF(ξ)$的傅里叶逆变化。在图形学中经常使用的是傅里叶变化与卷积的关系，如下图：

![[计算机图形学/attachments/Pic_020.png]]

## 傅里叶变换库

之前我们了解了常见的滤波器，我们先来了解下滤波器的傅里叶变换。因为要经常使用，我们先定义个函数$sincx = sinx / x$.  以下为常见滤波器的傅里叶变换:
[[3. 滤波器与图像信息处理#盒式滤波器|盒式滤波器]]：$F[fbox] = sinπμ / πμ = sincπμ$     
[[3. 滤波器与图像信息处理#帐篷滤波器|帐篷滤波器]]： $F[ften] = sin²πμ / π²μ² = sinc²πμ$    
[[3. 滤波器与图像信息处理#B样条立方滤波器|B样条立方滤波器]]：$F[fB]=sin4πμ / π4μ4 = sinc4πμ$ 
[[3. 滤波器与图像信息处理#高斯滤波器|高斯滤波器]]：：$F[fG]=e^(-(2πu)²/2)$  
***注：高斯滤波器的傅里叶变换后仍然是个标准偏差为$1/2π$的高斯函数。***

![[计算机图形学/attachments/Pic_021.png]]

# 采样与反走样

## 采样与走样

在图形学中经常会遇到采样重建(如:从$512*512$贴图采样在$400*300$的面上重构)，采样和重构的过程就可能用到卷积和滤波器。而已引入傅里叶变化的作用是更方便的分析出走样的噪音，方便选用特定的滤波器。假设我们在位置$a$进行采样，$b$为样值，我们可以用脉冲函数$bδ(x-a)$表示。图形学中这种固定间隔(周期)对连续函数采样可以表示为该函数与脉冲函数的乘积：         $Sr(x) = ∑δ(x-Ti)$   $T$表示固定间隔(周期), $i$表示从$-∞ ~ +∞$个周期。因为傅里叶变化中频率与原波相同时会有明显波动，因此傅里叶变换后的波的频率与脉冲函数频率相同(与周期互为倒数)如下图：

![[计算机图形学/attachments/Pic_022.png]]

假设对原信号进行脉冲采样采样函数为f*Sr(x)对此函数进行傅里叶变换$F[f*Sr(x)] = F[f] ★ F[Sr(x)]  (F[Sr(x)]$就是上图右侧部分以周期的倒数为频率的波形)：

![[计算机图形学/attachments/Pic_023.png]]

如上图右侧的傅里叶变换后的频率波可以看到，由于周期性波的相互叠加会在周期之间产生意外的波峰噪点，这就是走样。

## 反走样

对反走样的处理可以分别在三个阶段进行：对原始信号采样时反走样  在滤波重建时反走样，以及对重采样时进行反走样。

- **避免采样时走样**如上图傅里叶变换波形图所示走样产生的原因是因为周期性频率波相互叠加造成的，如果在采样时**增加采样频率**也就是说当采样频率大于信号中的最高频率一倍以上时就可以避免走样。但有些图片像素信号频率范围比较宽(比如有锯齿的边缘部分可能跨越好几个连续像素表达边缘信息)此时就需要在采样阶段使用滤波器函数对其进行滤波以降低原始信号的频率宽度。

![[计算机图形学/attachments/Pic_024.png]]
![[计算机图形学/attachments/Pic_025.png]]
![[计算机图形学/attachments/Pic_026.png]]

- **避免重构时走样：** 重构的阶段就是想采样后的不连续数据重新通过滤波器映射到新的连续(对像素来说不可能是真的连续但要用一个连续函数来计算每个像素点数据，如$800*600$的图片要映射到$1024*1024$屏幕上时要通过一个连续的函数计算出每个像素点的颜色值)信号中。重构时的反走样就是通过选取不同的滤波器函数将走样频谱过滤掉并还原出原始信号。

![[计算机图形学/attachments/Pic_027.png]]

- **避免重采样时走样** 一般重采样与采样使用同样的策略和滤波器。

***注：由以上内容你可能很容易第一个想到使用盒式滤波器解决走样问题最高效且最适合，因为盒式滤波器会将滤波范围以外的频率变为0,很容易的就去除了走样区域范围。但在实际中并不是这样因为盒式滤波器经过傅里叶变换变成了$sinπx/πx$.就采样来说此滤波器的傅里叶变化无限延伸且远离中心时函数值下降速度很慢，因此效果并不是很好。相反帐篷式滤波器和高斯滤波器的效果比盒式滤波器好很多。***

# 总结

- 在某一点$a$处的卷积本质上是两函数f和$g$在此点周围的乘积之和的积分: $∑ f(i)g(a-i)$
- 在图形学中如果将某点最终像素值计算作为卷积结果，原始像素集合为函数$f(x)$，则可以由滤波器函数$g(x)$对像素值产生影响。
- 常用滤波器函数有: 盒式滤波器函数，帐篷滤波器函数，高斯滤波器函数，B样条立方滤波函数等。
- 傅里叶变换的本质是将以时间/位置为单位描述振幅的波转化为以频率为单位描述振幅的波行图。利用傅里叶变换可以帮助我们更容易的分析出图像波(将每个像素作为值，像素位置作为变量的函数波)中的问题与解决方案，如走样。
- 反走样的几种处理方式：增大最原图像数据的采样频率，对某些频域较宽的(一个信息跨越几个像素，如边缘的锯齿等)先进行滤波处理再采样，在重构阶段选用合适的滤波器过滤走样信息。
